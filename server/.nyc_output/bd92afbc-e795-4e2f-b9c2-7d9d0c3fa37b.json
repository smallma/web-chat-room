{"/Users/cmd/Documents/Projects/Rain/Personal/web-chat-room/server/src/app.ts":{"path":"/Users/cmd/Documents/Projects/Rain/Personal/web-chat-room/server/src/app.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":256}},"2":{"start":{"line":4,"column":18},"end":{"line":4,"column":31}},"3":{"start":{"line":5,"column":19},"end":{"line":5,"column":44}},"4":{"start":{"line":6,"column":17},"end":{"line":6,"column":40}},"5":{"start":{"line":7,"column":10},"end":{"line":7,"column":31}},"6":{"start":{"line":8,"column":12},"end":{"line":8,"column":14}},"7":{"start":{"line":10,"column":17},"end":{"line":10,"column":27}},"8":{"start":{"line":11,"column":4},"end":{"line":11,"column":53}},"9":{"start":{"line":13,"column":0},"end":{"line":13,"column":26}},"10":{"start":{"line":15,"column":4},"end":{"line":17,"column":7}},"11":{"start":{"line":16,"column":8},"end":{"line":16,"column":25}},"12":{"start":{"line":19,"column":0},"end":{"line":19,"column":48}},"13":{"start":{"line":21,"column":20},"end":{"line":21,"column":40}},"14":{"start":{"line":22,"column":4},"end":{"line":24,"column":7}},"15":{"start":{"line":25,"column":25},"end":{"line":34,"column":5}},"16":{"start":{"line":35,"column":4},"end":{"line":35,"column":24}},"17":{"start":{"line":37,"column":0},"end":{"line":37,"column":40}},"18":{"start":{"line":39,"column":20},"end":{"line":39,"column":40}},"19":{"start":{"line":40,"column":25},"end":{"line":49,"column":5}},"20":{"start":{"line":50,"column":4},"end":{"line":50,"column":24}},"21":{"start":{"line":52,"column":0},"end":{"line":52,"column":40}},"22":{"start":{"line":54,"column":20},"end":{"line":54,"column":40}},"23":{"start":{"line":55,"column":20},"end":{"line":55,"column":32}},"24":{"start":{"line":56,"column":23},"end":{"line":56,"column":25}},"25":{"start":{"line":57,"column":4},"end":{"line":66,"column":5}},"26":{"start":{"line":59,"column":12},"end":{"line":59,"column":51}},"27":{"start":{"line":60,"column":12},"end":{"line":60,"column":18}},"28":{"start":{"line":62,"column":12},"end":{"line":62,"column":51}},"29":{"start":{"line":63,"column":12},"end":{"line":63,"column":18}},"30":{"start":{"line":65,"column":12},"end":{"line":65,"column":42}},"31":{"start":{"line":67,"column":4},"end":{"line":67,"column":24}},"32":{"start":{"line":69,"column":0},"end":{"line":69,"column":42}},"33":{"start":{"line":71,"column":16},"end":{"line":71,"column":61}},"34":{"start":{"line":72,"column":4},"end":{"line":74,"column":7}},"35":{"start":{"line":73,"column":8},"end":{"line":73,"column":20}},"36":{"start":{"line":75,"column":4},"end":{"line":75,"column":15}},"37":{"start":{"line":77,"column":0},"end":{"line":77,"column":28}},"38":{"start":{"line":79,"column":4},"end":{"line":81,"column":7}},"39":{"start":{"line":80,"column":8},"end":{"line":80,"column":40}},"40":{"start":{"line":82,"column":4},"end":{"line":82,"column":15}},"41":{"start":{"line":84,"column":0},"end":{"line":84,"column":38}},"42":{"start":{"line":86,"column":4},"end":{"line":88,"column":7}},"43":{"start":{"line":87,"column":8},"end":{"line":87,"column":43}},"44":{"start":{"line":89,"column":4},"end":{"line":89,"column":15}},"45":{"start":{"line":91,"column":0},"end":{"line":91,"column":40}},"46":{"start":{"line":93,"column":4},"end":{"line":95,"column":5}},"47":{"start":{"line":94,"column":8},"end":{"line":94,"column":15}},"48":{"start":{"line":96,"column":20},"end":{"line":96,"column":43}},"49":{"start":{"line":97,"column":4},"end":{"line":97,"column":19}},"50":{"start":{"line":99,"column":0},"end":{"line":99,"column":46}},"51":{"start":{"line":101,"column":4},"end":{"line":110,"column":7}},"52":{"start":{"line":102,"column":8},"end":{"line":109,"column":11}},"53":{"start":{"line":103,"column":28},"end":{"line":103,"column":58}},"54":{"start":{"line":104,"column":12},"end":{"line":108,"column":13}},"55":{"start":{"line":105,"column":37},"end":{"line":105,"column":61}},"56":{"start":{"line":106,"column":34},"end":{"line":106,"column":62}},"57":{"start":{"line":107,"column":16},"end":{"line":107,"column":51}},"58":{"start":{"line":112,"column":0},"end":{"line":112,"column":50}},"59":{"start":{"line":114,"column":4},"end":{"line":114,"column":93}},"60":{"start":{"line":116,"column":0},"end":{"line":116,"column":7}}},"fnMap":{"0":{"name":"getDate","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":16}},"loc":{"start":{"line":9,"column":19},"end":{"line":12,"column":1}},"line":9},"1":{"name":"handleBroadcastMsg","decl":{"start":{"line":14,"column":9},"end":{"line":14,"column":27}},"loc":{"start":{"line":14,"column":38},"end":{"line":18,"column":1}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":24},"end":{"line":15,"column":25}},"loc":{"start":{"line":15,"column":36},"end":{"line":17,"column":5}},"line":15},"3":{"name":"handleType1Msg","decl":{"start":{"line":20,"column":9},"end":{"line":20,"column":23}},"loc":{"start":{"line":20,"column":33},"end":{"line":36,"column":1}},"line":20},"4":{"name":"handleType2Msg","decl":{"start":{"line":38,"column":9},"end":{"line":38,"column":23}},"loc":{"start":{"line":38,"column":33},"end":{"line":51,"column":1}},"line":38},"5":{"name":"handlReceiveMsg","decl":{"start":{"line":53,"column":9},"end":{"line":53,"column":24}},"loc":{"start":{"line":53,"column":34},"end":{"line":68,"column":1}},"line":53},"6":{"name":"createWs","decl":{"start":{"line":70,"column":9},"end":{"line":70,"column":17}},"loc":{"start":{"line":70,"column":24},"end":{"line":76,"column":1}},"line":70},"7":{"name":"(anonymous_7)","decl":{"start":{"line":72,"column":20},"end":{"line":72,"column":21}},"loc":{"start":{"line":72,"column":37},"end":{"line":74,"column":5}},"line":72},"8":{"name":"handleWssOpen","decl":{"start":{"line":78,"column":9},"end":{"line":78,"column":22}},"loc":{"start":{"line":78,"column":28},"end":{"line":83,"column":1}},"line":78},"9":{"name":"(anonymous_9)","decl":{"start":{"line":79,"column":19},"end":{"line":79,"column":20}},"loc":{"start":{"line":79,"column":30},"end":{"line":81,"column":5}},"line":79},"10":{"name":"handleWssClose","decl":{"start":{"line":85,"column":9},"end":{"line":85,"column":23}},"loc":{"start":{"line":85,"column":29},"end":{"line":90,"column":1}},"line":85},"11":{"name":"(anonymous_11)","decl":{"start":{"line":86,"column":20},"end":{"line":86,"column":21}},"loc":{"start":{"line":86,"column":31},"end":{"line":88,"column":5}},"line":86},"12":{"name":"transferToJsonMsg","decl":{"start":{"line":92,"column":9},"end":{"line":92,"column":26}},"loc":{"start":{"line":92,"column":40},"end":{"line":98,"column":1}},"line":92},"13":{"name":"handleWssConnection","decl":{"start":{"line":100,"column":9},"end":{"line":100,"column":28}},"loc":{"start":{"line":100,"column":34},"end":{"line":111,"column":1}},"line":100},"14":{"name":"connection","decl":{"start":{"line":101,"column":34},"end":{"line":101,"column":44}},"loc":{"start":{"line":101,"column":49},"end":{"line":110,"column":5}},"line":101},"15":{"name":"message","decl":{"start":{"line":102,"column":34},"end":{"line":102,"column":41}},"loc":{"start":{"line":102,"column":55},"end":{"line":109,"column":9}},"line":102},"16":{"name":"main","decl":{"start":{"line":113,"column":9},"end":{"line":113,"column":13}},"loc":{"start":{"line":113,"column":16},"end":{"line":115,"column":1}},"line":113}},"branchMap":{"0":{"loc":{"start":{"line":57,"column":4},"end":{"line":66,"column":5}},"type":"switch","locations":[{"start":{"line":58,"column":8},"end":{"line":60,"column":18}},{"start":{"line":61,"column":8},"end":{"line":63,"column":18}},{"start":{"line":64,"column":8},"end":{"line":65,"column":42}}],"line":57},"1":{"loc":{"start":{"line":93,"column":4},"end":{"line":95,"column":5}},"type":"if","locations":[{"start":{"line":93,"column":4},"end":{"line":95,"column":5}},{"start":{"line":93,"column":4},"end":{"line":95,"column":5}}],"line":93},"2":{"loc":{"start":{"line":104,"column":12},"end":{"line":108,"column":13}},"type":"if","locations":[{"start":{"line":104,"column":12},"end":{"line":108,"column":13}},{"start":{"line":104,"column":12},"end":{"line":108,"column":13}}],"line":104}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":5,"8":5,"9":1,"10":1,"11":1,"12":1,"13":2,"14":2,"15":2,"16":2,"17":1,"18":2,"19":2,"20":2,"21":1,"22":3,"23":3,"24":3,"25":3,"26":1,"27":1,"28":1,"29":1,"30":1,"31":3,"32":1,"33":1,"34":1,"35":0,"36":1,"37":1,"38":1,"39":0,"40":1,"41":1,"42":1,"43":0,"44":1,"45":1,"46":2,"47":1,"48":1,"49":1,"50":1,"51":1,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":1,"59":1,"60":1},"f":{"0":5,"1":1,"2":1,"3":2,"4":2,"5":3,"6":1,"7":0,"8":1,"9":0,"10":1,"11":0,"12":2,"13":1,"14":0,"15":0,"16":1},"b":{"0":[1,1,1],"1":[1,1],"2":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/cmd/Documents/Projects/Rain/Personal/web-chat-room/server/src/app.ts","sources":["/Users/cmd/Documents/Projects/Rain/Personal/web-chat-room/server/src/app.ts"],"names":[],"mappings":"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","sourcesContent":["import * as WebSocket from 'ws';\nimport { pipe } from 'fp-ts/function'\nimport { Either, tryCatch, isRight } from 'fp-ts/Either'\nimport * as J from 'fp-ts/Json';\n\n\ntype userType = { nickname: string };\nlet Users:userType[] = [];\ninterface jsonMsg {\n  type: number;\n  nickname: string;\n  msg?: string;\n  selectAvatarId: number;\n  uuid: string;\n}\ninterface user {\n  nickname: string;\n}\ninterface broadcastMsg {\n  type?: number;\n  msgid?: number;\n  uuid?: string;\n  date?: string;\n  msg?: string;\n  users?: Array<user>;\n  selectAvatarId?: number;\n  nickname?: string;\n}\ninterface Event {\n  message: string;\n  [key: string]: any;\n}\n\ninterface emptyDict {\n}\n\nfunction getDate():string {\n  const date = new Date();\n  return `${date.getHours()}:${date.getMinutes()}`;\n}\n\nfunction handleBroadcastMsg(wss: any, msg: string):void {\n  wss.clients.forEach((client:any) => {\n    client.send(msg);\n  });\n}\n\nfunction handleType1Msg(jsonMsg: jsonMsg):broadcastMsg {\n  const getTime = new Date().getTime();\n  Users.push({\n    nickname: jsonMsg.nickname,\n  });\n\n  const broadcastMsg:broadcastMsg = {\n    type: 1,\n    msgid: getTime,\n    uuid: jsonMsg.uuid,\n    date: getDate(),\n    msg: jsonMsg.nickname + ' join chat room',\n    users: Users,\n    selectAvatarId: jsonMsg.selectAvatarId,\n    nickname: jsonMsg.nickname\n  };\n  \n  return broadcastMsg;\n}\n\nfunction handleType2Msg(jsonMsg: jsonMsg):broadcastMsg {\n  const getTime = new Date().getTime();\n\n  const broadcastMsg:broadcastMsg = {\n    type: 2,\n    msgid: getTime,\n    uuid: jsonMsg.uuid,\n    date: getDate(),\n    msg: jsonMsg.msg,\n    users: Users,\n    selectAvatarId: jsonMsg.selectAvatarId,\n    nickname: jsonMsg.nickname\n  };\n\n  return broadcastMsg;\n}\n\nfunction handlReceiveMsg(jsonMsg: jsonMsg):broadcastMsg {\n  const getTime:number = new Date().getTime();\n  const msgType:number = jsonMsg.type;\n  let broadcastMsg:broadcastMsg|emptyDict = {};\n  switch(msgType) {\n    case 1:\n      broadcastMsg = handleType1Msg(jsonMsg);\n      break;\n    case 2:\n      broadcastMsg = handleType2Msg(jsonMsg);\n      break;\n    default:\n      console.log('out of options');\n  }\n\n  return broadcastMsg;\n}\n\nfunction createWs(port:number):any {\n  const wss = new WebSocket.WebSocketServer({ port: port });\n  wss.on('error', function(event: Event) {\n    wss.close();\n  });\n\n  return wss;\n}\n\nfunction handleWssOpen(wss:WebSocket):WebSocket {\n  wss.on('open', (event:Event) => {\n    console.log('Server connected');\n  });\n\n  return wss;\n}\n\nfunction handleWssClose(wss:WebSocket):WebSocket {\n  wss.on('close', (event:Event) => {\n    console.log('Server disconnected');\n  });\n\n  return wss;\n}\n\nfunction transferToJsonMsg (reveiveData:string):jsonMsg|void {\n  if (!isRight(J.parse(reveiveData))) { return; }\n\n  const jsonMsg:jsonMsg = JSON.parse(reveiveData);\n\n  return jsonMsg;\n}\n\nfunction handleWssConnection (wss:WebSocket):void {\n  wss.on('connection', function connection(ws:WebSocket) {\n    ws.on('message', function message(reveiveData:string) {\n      const jsonMsg = transferToJsonMsg(reveiveData);\n      \n      if (jsonMsg) {\n        const broadcastMsg:broadcastMsg|emptyDict = handlReceiveMsg(jsonMsg);\n        const stringMsg:string = JSON.stringify(broadcastMsg);\n        handleBroadcastMsg(wss, stringMsg);\n      }\n    });\n  }); \n}\n\nfunction main(): void {\n  pipe(\n    createWs(8001),\n    handleWssOpen,\n    handleWssClose,\n    handleWssConnection\n  );\n}\n\nmain();\n\nexport { \n  getDate,\n  handleBroadcastMsg,\n  handleType1Msg,\n  handleType2Msg,\n  handlReceiveMsg,\n  createWs,\n  handleWssOpen,\n  handleWssClose,\n  transferToJsonMsg,\n  handleWssConnection\n};"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"af0ab80646999d405cb4d258f6d7100d5e56c63a","contentHash":"22e7b9be88a19df491e093857c5da16981890c519818c67a0ff5c45e2eff4f11"}}