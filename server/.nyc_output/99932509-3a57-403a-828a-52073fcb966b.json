{"/Users/cmd/Documents/Projects/Rain/Personal/web-chat-room/server/src/app.ts":{"path":"/Users/cmd/Documents/Projects/Rain/Personal/web-chat-room/server/src/app.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":228}},"2":{"start":{"line":4,"column":13},"end":{"line":4,"column":26}},"3":{"start":{"line":5,"column":19},"end":{"line":5,"column":44}},"4":{"start":{"line":6,"column":17},"end":{"line":6,"column":40}},"5":{"start":{"line":7,"column":10},"end":{"line":7,"column":31}},"6":{"start":{"line":8,"column":12},"end":{"line":8,"column":14}},"7":{"start":{"line":11,"column":17},"end":{"line":11,"column":27}},"8":{"start":{"line":12,"column":4},"end":{"line":12,"column":53}},"9":{"start":{"line":14,"column":0},"end":{"line":14,"column":26}},"10":{"start":{"line":16,"column":4},"end":{"line":18,"column":7}},"11":{"start":{"line":17,"column":8},"end":{"line":17,"column":25}},"12":{"start":{"line":20,"column":0},"end":{"line":20,"column":48}},"13":{"start":{"line":22,"column":20},"end":{"line":22,"column":40}},"14":{"start":{"line":23,"column":4},"end":{"line":25,"column":7}},"15":{"start":{"line":26,"column":25},"end":{"line":35,"column":5}},"16":{"start":{"line":36,"column":4},"end":{"line":36,"column":24}},"17":{"start":{"line":38,"column":0},"end":{"line":38,"column":40}},"18":{"start":{"line":40,"column":20},"end":{"line":40,"column":40}},"19":{"start":{"line":41,"column":25},"end":{"line":50,"column":5}},"20":{"start":{"line":51,"column":4},"end":{"line":51,"column":24}},"21":{"start":{"line":53,"column":0},"end":{"line":53,"column":40}},"22":{"start":{"line":55,"column":20},"end":{"line":55,"column":40}},"23":{"start":{"line":56,"column":20},"end":{"line":56,"column":32}},"24":{"start":{"line":57,"column":23},"end":{"line":57,"column":25}},"25":{"start":{"line":58,"column":4},"end":{"line":67,"column":5}},"26":{"start":{"line":60,"column":12},"end":{"line":60,"column":51}},"27":{"start":{"line":61,"column":12},"end":{"line":61,"column":18}},"28":{"start":{"line":63,"column":12},"end":{"line":63,"column":51}},"29":{"start":{"line":64,"column":12},"end":{"line":64,"column":18}},"30":{"start":{"line":66,"column":12},"end":{"line":66,"column":42}},"31":{"start":{"line":68,"column":4},"end":{"line":68,"column":24}},"32":{"start":{"line":70,"column":0},"end":{"line":70,"column":42}},"33":{"start":{"line":72,"column":16},"end":{"line":72,"column":56}},"34":{"start":{"line":73,"column":4},"end":{"line":76,"column":7}},"35":{"start":{"line":74,"column":8},"end":{"line":74,"column":53}},"36":{"start":{"line":75,"column":8},"end":{"line":75,"column":20}},"37":{"start":{"line":77,"column":4},"end":{"line":77,"column":15}},"38":{"start":{"line":79,"column":0},"end":{"line":79,"column":28}},"39":{"start":{"line":81,"column":4},"end":{"line":83,"column":7}},"40":{"start":{"line":82,"column":8},"end":{"line":82,"column":40}},"41":{"start":{"line":84,"column":4},"end":{"line":84,"column":15}},"42":{"start":{"line":86,"column":0},"end":{"line":86,"column":38}},"43":{"start":{"line":88,"column":4},"end":{"line":90,"column":7}},"44":{"start":{"line":89,"column":8},"end":{"line":89,"column":43}},"45":{"start":{"line":91,"column":4},"end":{"line":91,"column":15}},"46":{"start":{"line":93,"column":0},"end":{"line":93,"column":40}},"47":{"start":{"line":95,"column":4},"end":{"line":108,"column":7}},"48":{"start":{"line":96,"column":8},"end":{"line":107,"column":11}},"49":{"start":{"line":97,"column":12},"end":{"line":99,"column":13}},"50":{"start":{"line":98,"column":16},"end":{"line":98,"column":23}},"51":{"start":{"line":100,"column":28},"end":{"line":100,"column":51}},"52":{"start":{"line":101,"column":12},"end":{"line":101,"column":46}},"53":{"start":{"line":102,"column":33},"end":{"line":102,"column":57}},"54":{"start":{"line":103,"column":12},"end":{"line":106,"column":13}},"55":{"start":{"line":104,"column":16},"end":{"line":104,"column":60}},"56":{"start":{"line":105,"column":16},"end":{"line":105,"column":70}},"57":{"start":{"line":110,"column":0},"end":{"line":110,"column":50}},"58":{"start":{"line":112,"column":17},"end":{"line":112,"column":21}},"59":{"start":{"line":113,"column":4},"end":{"line":113,"column":93}},"60":{"start":{"line":115,"column":0},"end":{"line":115,"column":7}}},"fnMap":{"0":{"name":"getDate","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":16}},"loc":{"start":{"line":10,"column":19},"end":{"line":13,"column":1}},"line":10},"1":{"name":"handleBroadcastMsg","decl":{"start":{"line":15,"column":9},"end":{"line":15,"column":27}},"loc":{"start":{"line":15,"column":41},"end":{"line":19,"column":1}},"line":15},"2":{"name":"each","decl":{"start":{"line":16,"column":36},"end":{"line":16,"column":40}},"loc":{"start":{"line":16,"column":49},"end":{"line":18,"column":5}},"line":16},"3":{"name":"handleType1Msg","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":23}},"loc":{"start":{"line":21,"column":33},"end":{"line":37,"column":1}},"line":21},"4":{"name":"handleType2Msg","decl":{"start":{"line":39,"column":9},"end":{"line":39,"column":23}},"loc":{"start":{"line":39,"column":33},"end":{"line":52,"column":1}},"line":39},"5":{"name":"handlReceiveMsg","decl":{"start":{"line":54,"column":9},"end":{"line":54,"column":24}},"loc":{"start":{"line":54,"column":34},"end":{"line":69,"column":1}},"line":54},"6":{"name":"createWs","decl":{"start":{"line":71,"column":9},"end":{"line":71,"column":17}},"loc":{"start":{"line":71,"column":24},"end":{"line":78,"column":1}},"line":71},"7":{"name":"(anonymous_7)","decl":{"start":{"line":73,"column":20},"end":{"line":73,"column":21}},"loc":{"start":{"line":73,"column":37},"end":{"line":76,"column":5}},"line":73},"8":{"name":"handleWssOpen","decl":{"start":{"line":80,"column":9},"end":{"line":80,"column":22}},"loc":{"start":{"line":80,"column":28},"end":{"line":85,"column":1}},"line":80},"9":{"name":"(anonymous_9)","decl":{"start":{"line":81,"column":19},"end":{"line":81,"column":20}},"loc":{"start":{"line":81,"column":28},"end":{"line":83,"column":5}},"line":81},"10":{"name":"handleWssClose","decl":{"start":{"line":87,"column":9},"end":{"line":87,"column":23}},"loc":{"start":{"line":87,"column":29},"end":{"line":92,"column":1}},"line":87},"11":{"name":"(anonymous_11)","decl":{"start":{"line":88,"column":20},"end":{"line":88,"column":21}},"loc":{"start":{"line":88,"column":29},"end":{"line":90,"column":5}},"line":88},"12":{"name":"handleWssConnection","decl":{"start":{"line":94,"column":9},"end":{"line":94,"column":28}},"loc":{"start":{"line":94,"column":34},"end":{"line":109,"column":1}},"line":94},"13":{"name":"connection","decl":{"start":{"line":95,"column":34},"end":{"line":95,"column":44}},"loc":{"start":{"line":95,"column":49},"end":{"line":108,"column":5}},"line":95},"14":{"name":"message","decl":{"start":{"line":96,"column":34},"end":{"line":96,"column":41}},"loc":{"start":{"line":96,"column":55},"end":{"line":107,"column":9}},"line":96},"15":{"name":"main","decl":{"start":{"line":111,"column":9},"end":{"line":111,"column":13}},"loc":{"start":{"line":111,"column":16},"end":{"line":114,"column":1}},"line":111}},"branchMap":{"0":{"loc":{"start":{"line":58,"column":4},"end":{"line":67,"column":5}},"type":"switch","locations":[{"start":{"line":59,"column":8},"end":{"line":61,"column":18}},{"start":{"line":62,"column":8},"end":{"line":64,"column":18}},{"start":{"line":65,"column":8},"end":{"line":66,"column":42}}],"line":58},"1":{"loc":{"start":{"line":97,"column":12},"end":{"line":99,"column":13}},"type":"if","locations":[{"start":{"line":97,"column":12},"end":{"line":99,"column":13}},{"start":{"line":97,"column":12},"end":{"line":99,"column":13}}],"line":97},"2":{"loc":{"start":{"line":103,"column":12},"end":{"line":106,"column":13}},"type":"if","locations":[{"start":{"line":103,"column":12},"end":{"line":106,"column":13}},{"start":{"line":103,"column":12},"end":{"line":106,"column":13}}],"line":103}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":5,"8":5,"9":1,"10":0,"11":0,"12":1,"13":2,"14":2,"15":2,"16":2,"17":1,"18":2,"19":2,"20":2,"21":1,"22":3,"23":3,"24":3,"25":3,"26":1,"27":1,"28":1,"29":1,"30":1,"31":3,"32":1,"33":1,"34":1,"35":0,"36":0,"37":1,"38":1,"39":1,"40":0,"41":1,"42":1,"43":1,"44":0,"45":1,"46":1,"47":1,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":1,"58":1,"59":1,"60":1},"f":{"0":5,"1":0,"2":0,"3":2,"4":2,"5":3,"6":1,"7":0,"8":1,"9":0,"10":1,"11":0,"12":1,"13":0,"14":0,"15":1},"b":{"0":[1,1,1],"1":[0,0],"2":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/cmd/Documents/Projects/Rain/Personal/web-chat-room/server/src/app.ts","sources":["/Users/cmd/Documents/Projects/Rain/Personal/web-chat-room/server/src/app.ts"],"names":[],"mappings":"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","sourcesContent":["import { WebSocketServer, OPEN } from 'ws';\nimport { pipe } from 'fp-ts/function'\nimport { number } from 'fp-ts';\nimport { Either, tryCatch, isRight } from 'fp-ts/Either'\nimport * as J from 'fp-ts/Json';\n\ntype userType = { nickname: string };\nlet Users:userType[] = [];\n\ninterface emptyDict {};\ninterface jsonMsg {\n  type: number;\n  nickname: string;\n  msg?: string;\n  selectAvatarId: number;\n  uuid: string;\n}\ninterface user {\n  nickname: string;\n}\ninterface broadcastMsg {\n  type?: number;\n  msgid?: number;\n  uuid?: string;\n  date?: string;\n  msg?: string;\n  users?: Array<user>;\n  selectAvatarId?: number;\n  nickname?: string;\n}\n\nfunction getDate():string {\n  // return moment().format('HH:mm')\n  const date = new Date();\n  return `${date.getHours()}:${date.getMinutes()}`;\n}\n\nfunction handleBroadcastMsg(server: any, msg: string):void {\n  server.clients.forEach(function each(client: any) {\n    client.send(msg);\n  });\n}\n\nfunction handleType1Msg(jsonMsg: jsonMsg):broadcastMsg {\n  const getTime = new Date().getTime();\n  Users.push({\n    nickname: jsonMsg.nickname,\n  });\n\n  const broadcastMsg:broadcastMsg = {\n    type: 1,\n    msgid: getTime,\n    uuid: jsonMsg.uuid,\n    date: getDate(),\n    msg: jsonMsg.nickname + ' join chat room',\n    users: Users,\n    selectAvatarId: jsonMsg.selectAvatarId,\n    nickname: jsonMsg.nickname\n  };\n  \n  return broadcastMsg;\n}\n\nfunction handleType2Msg(jsonMsg: jsonMsg):broadcastMsg {\n  const getTime = new Date().getTime();\n\n  const broadcastMsg:broadcastMsg = {\n    type: 2,\n    msgid: getTime,\n    uuid: jsonMsg.uuid,\n    date: getDate(),\n    msg: jsonMsg.msg,\n    users: Users,\n    selectAvatarId: jsonMsg.selectAvatarId,\n    nickname: jsonMsg.nickname\n  };\n\n  return broadcastMsg;\n}\n\nfunction handlReceiveMsg(jsonMsg: jsonMsg):any {\n  const getTime:number = new Date().getTime();\n  const msgType:number = jsonMsg.type;\n  let broadcastMsg:broadcastMsg = {};\n  switch(msgType) {\n    case 1:\n      broadcastMsg = handleType1Msg(jsonMsg);\n      break;\n    case 2:\n      broadcastMsg = handleType2Msg(jsonMsg);\n      break;\n    default:\n      console.log('out of options');\n  }\n\n  return broadcastMsg;\n}\n\nfunction createWs(port: number):any {\n  const wss = new WebSocketServer({ port: port });\n  wss.on('error', function(event: any) {\n    console.log('Server error: ', event.message);\n    wss.close();\n  });\n\n  return wss;\n}\n\nfunction handleWssOpen (wss:any):any {\n  wss.on('open', (evt:any) => {\n    console.log('Server connected');\n  });\n\n  return wss;\n}\n\nfunction handleWssClose (wss:any):any {\n  wss.on('close', (evt:any) => {\n    console.log('Server disconnected');\n  });\n\n  return wss;\n}\n\n// const _validateStringParsing = (str: string): Either<Error, unknown> => \n//   tryCatch<Error, unknown>(\n//     () => JSON.parse(str),\n//     (err) => (err instanceof Error ? err : Error('parsing Error'))\n//   );\n\nfunction handleWssConnection (wss:any):void {\n  wss.on('connection', function connection(ws:any) {\n    ws.on('message', function message(reveiveData:string) {\n      // const validatedData = _validateStringParsing(reveiveData);\n      // console.log('validatedData: ', validatedData);\n      // console.log('validatedData2: ', J.parse(reveiveData));\n      if (!isRight(J.parse(reveiveData))) { return; }\n\n      // const jsonMsg:jsonMsg = transformMsg.right;\n      const jsonMsg:jsonMsg = JSON.parse(reveiveData);\n      console.log('jsonMsg: ', jsonMsg);\n      const broadcastMsg:broadcastMsg | {} = handlReceiveMsg(jsonMsg);\n\n      if (broadcastMsg) {\n        console.log('broadcastMsg: ', broadcastMsg);\n        handleBroadcastMsg(wss, JSON.stringify(broadcastMsg));\n      }\n    });\n  }); \n}\n\nfunction main(): void {\n  const port:number = 8001;\n\n  pipe(\n    createWs(port),\n    handleWssOpen,\n    handleWssClose,\n    handleWssConnection\n  );\n}\n\nmain();\n\nexport { \n  getDate,\n  handleBroadcastMsg,\n  handleType1Msg,\n  handleType2Msg,\n  handlReceiveMsg,\n  createWs,\n  handleWssOpen,\n  handleWssClose,\n  handleWssConnection\n};"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3b405d1ab866a9cdee9f87214a2d440405320b6b","contentHash":"01b83efcfc8a09b935a517aee9ae84793152a2531687abd36528315984c93613"}}